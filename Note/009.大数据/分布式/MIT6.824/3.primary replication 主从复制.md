# 主从复制
1. 状态转移(State Transfer)：primary存储的快照同步到second
2. 复制状态机(Replicated State Machine)：primary把执行指令同步到second
#问题
    我们要复制哪些状态？
    主机必须等待备机备份完吗？
    什么时候切换到备机？
    切换时能否看到异常情况？
    如果有个副本故障了，我们需要重新添加一个新的副本，这可能是一个代价很高的行为，因为副本可能非常大，如何提升添加新副本的速度？
1. 输出规则：主机直到备机接收并确认了和输出相关的日志的时候，才发送输出给外界。
2. 如果备机故障，主机就会停止向 logging channel 发送日志，继续正常运行。 在这之后备机怎么追上主机呢？VMware有一个工具叫 VMotion，它能够在最小程度上中断虚拟机的执行，克隆一个虚拟机。
3. 如果主机故障，备机必须先重放，直到消耗完最后一个日志项。然后备机接替主机，开始向客户端生产输出。
4. 避免出现脑裂 split_brian 加共享存储锁
5. Primary会等到Backup已经有了最新的数据，才会将回复返回给客户端。这几乎是所有的复制方案中对于性能产生伤害的地方。这里的同步等待使得Primary不能超前Backup太多，因为如果Primary超前
# Test-and-Set 脑裂情况下确定primary
