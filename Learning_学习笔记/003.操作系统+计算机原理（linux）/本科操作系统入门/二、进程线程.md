[toc]
# 进程和线程和协程
## 协程 
共享内存 协程 不用等待请求返回


## 进程和线程的区别
进程和线程以及它们的区别

1. ==进程是对运行时程序的封装==，是==系统进行资源调度和分配的的基本单位==，实现了操作系统的并发；
1. ==线程是进程的子任务，是CPU调度和分派的基本单位==，用于保证程序的 实时性，实现进程内部的并发；
1. 一个程序至少有一个进程，一个进程至少有一个线程，线程依赖于进程而存在；
1. ==进程在执行过程中拥有独立的内存单元，而多个线程共享进程的内存==

https://www.zhihu.com/question/25532384/answer/81152571

线程作为进程的一部分，==扮演的角色就是怎么利用中央处理器去运行代码==。这其中牵扯到的最重要资源的是中央处理器和其中的寄存器，和线程的栈（stack）。这里想强调的是，线程关注的是中央处理器的运行，而不是内存等资源的管理。

==进程更倾向于内存管理的概念==

他在自己的区域掌控自己的资源 也不越界



==线程更倾向于cpu的运行==

当前的计算机的cpu总要跑在一个线程上 但是又无法做到同时跑在多个线程上

看似多线程可以同时运行 其实他们之间是通过时间片的切换来做到的


## 进程
###  进程定义：
1. 进程是程序的一次执行；
1. 进程是一个程序及其数据在处理机上顺序执行时所发生的活动；
1. 进程是程序在一个数据集合上运行的过程，是系统进行资源分配和调度的一个独立单位
1. 进程是进程实体的运行过程，是系统进行资源分配和调度的一个独立单位

###  进程的三种基本状态
==就绪、执行、阻塞==

阻塞状态是缺少需要的资源从而由运行状态转换而来，但是该资源不包括 CPU，缺少 CPU 会让进程从==运行态转换为就绪态==。

只有就绪态和运行态可以相互转换，其它的都是单向转换。就绪状态的进程通过调度算法从而获得 CPU 时间，转为运行状态；而运行状态的进程，在分配给它的 CPU 时间片用完之后就会转为就绪状态，等待下一次调度。
### 进程间的通信五种方式
                                                            
#### 1 共享内存
==即多个进程共享某块内存，共享内存是通信方式中最快的一种。==

操作系统建立一块共享内存，并将其映射到参与通信的每个进程的地址空间上，进程就可以直接对这块共享内存进行读写。

#### 2 消息队列:
类似于用链表的结构存储消息。
![image](https://img-blog.csdn.net/20180513164327588?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2I5eF9f/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
它克服了上两种通信方式中信号量有限的缺点，具有写权限得进程可以按照一定得规则向消息队列中添加新信息；对消息队列有读权限得进程则可以从消息队列中读取信息；

#### 3 管道pipe通信
==即管道为空时读进程会阻塞，管道为满时写进程会阻塞，以此实现进程之间的通信==。一个进程的输入作为另一个进程的输出
生产者消费者模式，内存不共享

##### 普通管道：
  它是半双工的，即只能单向传输。
  它是有进程关系限制的，只能在父子进程之间使用。

##### 流管道:
   相对于普通管道而言，它不止是单向传输，可以双向传输。

##### 命名管道(FIFO)：
 相对于普通管道而言，它没有进程关系限制，可以在无关进程之间进行数据交换。



#### 4 套接字
    与其它通信机制不同是，套接字可用于不同机器间的进程通信，即可用于网络之间的进程通信。
![image](https://img-blog.csdn.net/20180513165052722?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2I5eF9f/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
#### 5 信号量
   信号量用于实现进程间的互斥与同步，而不是用于存储进程间通信数据。它是一个计数器，用来控制多个进程对共享资源的访问，常作为一种锁机制，实现进程间的同步和互斥。(JUC的Semaphore的设计思想来源吧)
   


### 进程控制与同步
#### 1 信号量的应用
实现进程互斥；
实现前驱关系

#### 2 经典进程的同步问题

生产者-消费者问题？
哲学家进餐问题？
读者-写者问题
## 线程
###  线程定义
==线程是程序中一个单一的顺序控制流程，是系统独立调度和分派CPU的基本单位==。==同一个进程的多个线程共享相同的：代码段、数据段、操作系统的资源，可并发执行==

### 线程有几种状态？

　　在 Java虚拟机 中，线程从最初的创建到最终的消亡，要经历若干个状态：创建(new)、就绪(runnable/start)、运行(running)、阻塞(blocked)、等待(waiting)、时间等待(time waiting) 和 消亡(dead/terminated)。在给定的时间点上，一个线程只能处于一种状态
![image](http://static.zybuluo.com/Rico123/ot7o6218591iwj9py999hs1u/%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%8A%B6%E6%80%81.jpg)
### 线程间的同步和通信
#### 1.互斥锁（mutex）

互斥锁比较简单，用于实现线程间对资源互斥访问的机制。有两种状态，开锁和关锁状态。

当一个线程需要读/写一个共享数据时，线程首先应该为该数据段所设置的mutex执行关锁命令。首先判别mutex的状态，如果已经处于关锁状态，则访问该数据段的线程将被阻塞；如果mutex处于开锁状态，则将mutex关上之后进行读/写。

完成读/写之后将mutex设置成开锁状态，并唤醒阻塞在该互斥锁上的线程。

#### 2.条件变量

只利用mutex来实现互斥访问可能会引起互斥锁。

每个条件变量通常都与一个互斥锁一起使用，在创建一个互斥锁的同时便联系一个条件变量。单纯的互斥锁用于短期锁定，主要是保证对临界区的互斥进入，条件变量则用于线程的长期等待，直至等待的资源成为可用的资源。

#### 3.信号量机制：分为私有信号量与公有信号量



